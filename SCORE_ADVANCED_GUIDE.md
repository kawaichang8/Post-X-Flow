# 自然さスコア高度化ガイド

Post-X-Flowの自然さスコア（0-100）を高度化する機能の実装内容と使用方法を説明します。

## 実装内容

### 1. 複数AI評価平均化オプション

AIバイアスを減らすため、複数のAI（Claude + Grok）で評価して平均化する機能を追加しました。

**機能**:
- ClaudeとGrokの両方で評価
- 評価結果を平均化
- AIバイアスを減らしてより正確なスコアを算出

**使用方法**:
1. スコア計算設定パネルで「複数AI評価平均化」を有効化
2. 使用するAIプロバイダーを選択（Grok、Claude）
3. ツイート生成時に自動的に複数AIで評価

### 2. スコア計算ロジックの公開・カスタマイズ

スコア計算の重み付けをカスタマイズできるUIスライダーを追加しました。

**機能**:
- 各スコア要素の重み付けを調整可能
- リアルタイムでスコアを再計算
- 設定をローカルストレージに保存

**カスタマイズ可能な要素**:
- 文字数スコア（0-100%）
- ハッシュタグスコア（0-100%）
- スパム指標スコア（0-100%）
- 可読性スコア（0-100%）
- AI評価スコア（0-100%）

### 3. 閾値以下で自動警告

設定可能な閾値以下で自動的に警告を表示する機能を追加しました。

**機能**:
- カスタマイズ可能な警告閾値（デフォルト: 60点）
- 閾値以下で自動警告表示
- 複数の警告条件に対応

**警告条件**:
- スコアが閾値以下
- スパム指標が検出された
- 文字数が適切でない

## 使用方法

### 基本的な使い方

1. **ダッシュボード**で「ツイート」タブを開く
2. **スコア計算設定**パネルを開く（「詳細設定」→「スコア計算設定」）
3. **設定をカスタマイズ**:
   - 各スコア要素の重み付けをスライダーで調整
   - 警告閾値を設定
   - 複数AI評価平均化を有効化（オプション）
4. **「保存」**ボタンをクリック（設定を保存）
5. **ツイートを生成**（設定が自動的に適用される）

### スコア計算設定の例

#### パターン1: デフォルト設定
- 文字数: 20%
- ハッシュタグ: 15%
- スパム指標: 20%
- 可読性: 15%
- AI評価: 30%
- 警告閾値: 60点

#### パターン2: AI評価重視
- 文字数: 15%
- ハッシュタグ: 10%
- スパム指標: 15%
- 可読性: 10%
- AI評価: **50%**
- 警告閾値: 70点

#### パターン3: ルールベース重視
- 文字数: **30%**
- ハッシュタグ: **20%**
- スパム指標: **30%**
- 可読性: **20%**
- AI評価: 0%
- 警告閾値: 50点

#### パターン4: 複数AI評価平均化
- 複数AI評価平均化: **有効**
- AIプロバイダー: Grok + Claude
- その他の設定はデフォルト

## 技術的な実装

### API変更

#### `lib/security/score-calculator-advanced.ts`

```typescript
export interface ScoreConfig {
  weights: ScoreWeights
  threshold: number
  enableMultiAI: boolean
  aiProviders: ('claude' | 'grok')[]
}

export async function calculateAdvancedNaturalnessScore(
  text: string,
  hashtags: string[],
  config: Partial<ScoreConfig> = {},
  aiScores?: number[]
): Promise<AdvancedScoreBreakdown>
```

#### `lib/ai-generator.ts`

```typescript
export interface GeneratePostsParams {
  // ... 既存のパラメータ
  scoreConfig?: Partial<ScoreConfig> // スコア計算設定（オプション）
}
```

### UI変更

#### `components/ScoreConfigPanel.tsx`

- スコア重み付けスライダー
- 警告閾値設定
- 複数AI評価平均化オプション
- 設定の保存・リセット機能

#### `components/PostDraft.tsx`

- 警告メッセージの表示
- スコア詳細の表示（オプション）

## 期待される効果

### 複数AI評価平均化

- **AIバイアス削減**: 複数のAIで評価することで、単一AIのバイアスを減らす
- **精度向上**: より正確なスコア算出
- **信頼性向上**: ユーザーからの信頼が向上

### カスタマイズ可能な重み付け

- **柔軟性**: 用途に応じてスコア計算を調整
- **透明性**: スコア計算ロジックが公開され、理解しやすい
- **最適化**: ユーザーの好みに合わせて最適化

### 自動警告機能

- **スパム回避**: 低スコアの投稿を事前に検出
- **品質向上**: 警告に基づいて改善
- **リスク軽減**: スパム判定のリスクを軽減

## 注意事項

1. **複数AI評価**: 複数AI評価平均化を使用する場合、両方のAPIキーが必要です
2. **重み付けの合計**: 重み付けの合計が1.0に近い値になるよう調整してください
3. **APIコスト**: 複数AI評価を使用すると、APIコストが増加します
4. **パフォーマンス**: 複数AI評価は処理時間が長くなります

## トラブルシューティング

### 複数AI評価が動作しない

- 両方のAPIキー（`GROK_API_KEY`、`ANTHROPIC_API_KEY`）が設定されているか確認
- ブラウザのコンソールでエラーを確認

### スコアが期待と異なる

- 重み付けの合計が1.0に近いか確認
- 各スコア要素の値を確認（詳細表示）
- 設定をリセットして再試行

### 警告が表示されない

- 警告閾値が正しく設定されているか確認
- スコアが閾値以下か確認

## 今後の拡張

- スコア計算履歴の保存
- A/Bテスト機能（異なる設定での比較）
- スコア改善提案の自動生成
- 機械学習による最適重み付けの提案

## 参考資料

- [Post-X-Flow README](./README.md)
- [スコア計算ロジック（基本版）](./lib/security/score-calculator.ts)
- [スコア計算ロジック（高度化版）](./lib/security/score-calculator-advanced.ts)
